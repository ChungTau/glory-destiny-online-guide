FROM node:20-alpine

WORKDIR /app

# 安裝 pnpm
RUN npm install -g pnpm

# 拷貝 monorepo 根目錄配置文件
COPY package.json pnpm-workspace.yaml tsconfig.base.json ./
COPY apps/cms/package.json apps/cms/
COPY packages/ui/package.json packages/ui/
COPY packages/ui/postcss.config.mjs packages/ui/
COPY packages/prisma/package.json packages/prisma/

# 安裝依賴
RUN pnpm install --force

# 拷貝應用同共享包嘅源碼
COPY apps/cms ./apps/cms
COPY packages/ui ./packages/ui
COPY packages/prisma ./packages/prisma

# 進入 cms 目錄
WORKDIR /app/apps/cms

EXPOSE 3000

CMD ["pnpm", "dev"]